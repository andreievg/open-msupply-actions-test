name: test-front-end

on:
  pull_request:
    # Not on edit (as it maybe too much to test on every commit, push below will deal with on merge)
    types: [opened, reopened]
    paths: ["client/**"]
  push:
    # When PR is merged (or any other commits directly to master or develop)
    branches: [main, develop]
    paths: ["client/**"]
  # For manually triggered workflow, can specify what to test
  workflow_dispatch:
    inputs:
      front-end:
        description: 'Test Front End'
        required: true
        default: true
        type: boolean
      electron:
        description: 'Test Electron Client'
        required: true
        # Should only be tested manually
        default: false
        type: boolean

jobs:
  test-front-end:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Cache
        uses: actions/cache@v3
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}

      - name: Install
        working-directory: client
        run: yarn install

      - name: Compile
         # When not running from workflow_dispath (!github.event_name == 'workflow_dispath'), alway do front end compilation and test
        if: inputs.front-end || !github.event_name == 'workflow_dispath'
        working-directory: client
        run: yarn compile
      
      - name: Test
        # When not running from workflow_dispath (!github.event_name == 'workflow_dispath'), alway do front end compilation and test
        if: inputs.front-end || !github.event_name == 'workflow_dispath'
        working-directory: client
        run: yarn test-full-speed
      
      - name: Compile Electron
        # Wouldn't run by default, when not running from workflow_dispatch dont' run
        if: inputs.electron
        working-directory: client
        run: yarn electron:compile